#include <LPC21xx.H>
#include "delay.h"
#include "defines.h"
#include "dml.h"
#include "sipo.h"

#define ROW 16

/** fonts array **/
unsigned char font[96][8]={
{0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff},//space
{0xe7 ,0xc3 ,0xc3 ,0xe7 ,0xe7 ,0xff ,0xe7 ,0xff },//'!'
{0x99 ,0x99 ,0x99 ,0xff ,0xff ,0xff ,0xff ,0xff },//'"'
{0xc9 ,0xc9 ,0x80 ,0xc9 ,0x80 ,0xc9 ,0xc9 ,0xff },//'#'
{0xf7 ,0xc1 ,0xf5 ,0xc1 ,0xd7 ,0xc1 ,0xf7 ,0xff },//'$'
{0xff ,0x9c ,0xcc ,0xe7 ,0xf3 ,0x99 ,0x9c ,0xff },//'%'
{0xe3 ,0xc9 ,0xe3 ,0x91 ,0xc4 ,0xcc ,0x91 ,0xff },//'&'
{0xe7 ,0xe7 ,0xf3 ,0xff ,0xff ,0xff ,0xff ,0xff },//'''
{0xcf ,0xe7 ,0xf3 ,0xf3 ,0xf3 ,0xe7 ,0xcf ,0xff },//'('
{0xf3 ,0xe7 ,0xcf ,0xcf ,0xcf ,0xe7 ,0xf3 ,0xff },//')'
{0xff ,0x99 ,0xc3 ,0x80 ,0xc3 ,0x99 ,0xff ,0xff },//'*'
{0xff ,0xe7 ,0xe7 ,0x81 ,0xe7 ,0xe7 ,0xff ,0xff },//'+'
{0xff ,0xff ,0xff ,0xff ,0xe7 ,0xe7 ,0xf3 ,0xff },//','
{0xff ,0xff ,0xff ,0x80 ,0xff ,0xff ,0xff ,0xff },//'-'
{0xff ,0xff ,0xff ,0xff ,0xff ,0xf3 ,0xf3 ,0xff },//'.'
{0x9f ,0xcf ,0xe7 ,0xf3 ,0xf9 ,0xfc ,0xfe ,0xff },//'/'
{0xc1 ,0x9c ,0x8c ,0x84 ,0x90 ,0x98 ,0xc1 ,0xff },//'0'
{0xe7 ,0xe3 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0x81 ,0xff },//'1'
{0xc3 ,0x99 ,0x9f ,0xc7 ,0xf3 ,0x99 ,0x81 ,0xff },//'2'
{0xc3 ,0x99 ,0x9f ,0xc7 ,0x9f ,0x99 ,0xc3 ,0xff },//'3'
{0xc7 ,0xc3 ,0xc9 ,0xcc ,0x80 ,0xcf ,0x87 ,0xff },//'4'
{0x81 ,0xf9 ,0xc1 ,0x9f ,0x9f ,0x99 ,0xc3 ,0xff },//'5'
{0xc7 ,0xf3 ,0xf9 ,0xc1 ,0x99 ,0x99 ,0xc3 ,0xff },//'6'
{0x81 ,0x99 ,0x9f ,0xcf ,0xe7 ,0xe7 ,0xe7 ,0xff },//'7'
{0xc3 ,0x99 ,0x99 ,0xc3 ,0x99 ,0x99 ,0xc3 ,0xff },//'8'
{0xc3 ,0x99 ,0x99 ,0x83 ,0x9f ,0xcf ,0xe3 ,0xff },//'9'
{0xff ,0xf3 ,0xf3 ,0xff ,0xff ,0xf3 ,0xf3 ,0xff },//':'
{0xf3 ,0xf3 ,0xff ,0xff ,0xf3 ,0xf3 ,0xf9 ,0xff },//';'
{0xe7 ,0xf3 ,0xf9 ,0xfc ,0xf9 ,0xf3 ,0xe7 ,0xff },//'<'
{0xff ,0xff ,0x80 ,0xff ,0xff ,0x80 ,0xff ,0xff },//'='
{0xf9 ,0xf3 ,0xe7 ,0xcf ,0xe7 ,0xf3 ,0xf9 ,0xff },//'>'
{0xe1 ,0xcc ,0xcf ,0xe7 ,0xf3 ,0xff ,0xf3 ,0xff },//'?'
{0xc1 ,0x9c ,0x84 ,0x84 ,0x84 ,0xfc ,0xe1 ,0xff },//'@'
{0xe7 ,0xc3 ,0x99 ,0x99 ,0x81 ,0x99 ,0x99 ,0xff },//'A'
{0xc0 ,0x99 ,0x99 ,0xc1 ,0x99 ,0x99 ,0xc0 ,0xff },//'B'
{0xc3 ,0x99 ,0xfc ,0xfc ,0xfc ,0x99 ,0xc3 ,0xff },//'C'
{0xe0 ,0xc9 ,0x99 ,0x99 ,0x99 ,0xc9 ,0xe0 ,0xff },//'D'
{0x80 ,0xb9 ,0xe9 ,0xe1 ,0xe9 ,0xb9 ,0x80 ,0xff },//'E'
{0x80 ,0xb9 ,0xe9 ,0xe1 ,0xe9 ,0xf9 ,0xf0 ,0xff },//'F'
{0xc3 ,0x99 ,0xfc ,0xfc ,0x8c ,0x99 ,0x81 ,0xff },//'G'
{0x99 ,0x99 ,0x99 ,0x81 ,0x99 ,0x99 ,0x99 ,0xff },//'H'
{0xc3 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'I'
{0x87 ,0xcf ,0xcf ,0xcf ,0xcc ,0xcc ,0xe1 ,0xff },//'J'
{0x98 ,0x99 ,0xc9 ,0xe1 ,0xc9 ,0x99 ,0x98 ,0xff },//'K'
{0xf0 ,0xf9 ,0xf9 ,0xf9 ,0xb9 ,0x99 ,0x80 ,0xff },//'L'
{0x9c ,0x88 ,0x80 ,0x80 ,0x94 ,0x9c ,0x9c ,0xff },//'M'
{0x9c ,0x98 ,0x90 ,0x84 ,0x8c ,0x9c ,0x9c ,0xff },//'N'
{0xe3 ,0xc9 ,0x9c ,0x9c ,0x9c ,0xc9 ,0xe3 ,0xff },//'O'
{0xc0 ,0x99 ,0x99 ,0xc1 ,0xf9 ,0xf9 ,0xf0 ,0xff },//'P'
{0xc3 ,0x99 ,0x99 ,0x99 ,0x89 ,0xc3 ,0x8f ,0xff },//'Q'
{0xc0 ,0x99 ,0x99 ,0xc1 ,0x89 ,0x99 ,0x98 ,0xff },//'R'
{0xc3 ,0x99 ,0xf1 ,0xe3 ,0x8f ,0x99 ,0xc3 ,0xff },//'S'
{0x81 ,0xa5 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'T'
{0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0xc3 ,0xff },//'U'
{0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0xc3 ,0xe7 ,0xff },//'V'
{0x9c ,0x9c ,0x9c ,0x94 ,0x80 ,0x88 ,0x9c ,0xff },//'W'
{0x9c ,0xc9 ,0xe3 ,0xf7 ,0xe3 ,0xc9 ,0x9c ,0xff },//'X'
{0x99 ,0x99 ,0x99 ,0xc3 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'Y'
{0x80 ,0x9c ,0xce ,0xe7 ,0xb3 ,0x99 ,0x80 ,0xff },//'Z'
{0xe1 ,0xf9 ,0xf9 ,0xf9 ,0xf9 ,0xf9 ,0xe1 ,0xff },//'['
{0xfc ,0xf9 ,0xf3 ,0xe7 ,0xcf ,0x9f ,0xbf ,0xff },//'\'
{0xe1 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe1 ,0xff },//']'
{0xf7 ,0xe3 ,0xc9 ,0x9c ,0xff ,0xff ,0xff ,0xff },//'^'
{0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0x80 },//'_'
{0xf3 ,0xf3 ,0xe7 ,0xff ,0xff ,0xff ,0xff ,0xff },//'`'
{0xff ,0xff ,0xe1 ,0xcf ,0xc1 ,0xcc ,0x91 ,0xff },//'a'
{0xf8 ,0xf9 ,0xf9 ,0xc1 ,0x99 ,0x99 ,0xc4 ,0xff },//'b'
{0xff ,0xff ,0xe1 ,0xcc ,0xfc ,0xcc ,0xe1 ,0xff },//'c'
{0xc7 ,0xcf ,0xcf ,0xc1 ,0xcc ,0xcc ,0x91 ,0xff },//'d'
{0xff ,0xff ,0xe1 ,0xcc ,0xc0 ,0xfc ,0xe1 ,0xff },//'e'
{0xe3 ,0xc9 ,0xf9 ,0xf0 ,0xf9 ,0xf9 ,0xf0 ,0xff },//'f'
{0xff ,0xff ,0xe1 ,0xcc ,0xcc ,0xc0 ,0xcf ,0xe1 },//'g'
{0xf8 ,0xf9 ,0xc9 ,0x91 ,0x99 ,0x99 ,0x98 ,0xff },//'h'
{0xf3 ,0xff ,0xf1 ,0xf3 ,0xf3 ,0xf3 ,0xe1 ,0xff },//'i'
{0xcf ,0xff ,0xcf ,0xcf ,0xcf ,0xcc ,0xcc ,0xe1 },//'j'
{0xf8 ,0xf9 ,0x99 ,0xc9 ,0xe1 ,0xc9 ,0x98 ,0xff },//'k'
{0xf1 ,0xf3 ,0xf3 ,0xf3 ,0xf3 ,0xf3 ,0xe1 ,0xff },//'l'
{0xff ,0xff ,0xc9 ,0x80 ,0x80 ,0x94 ,0x9c ,0xff },//'m'
{0xff ,0xff ,0xe0 ,0xcc ,0xcc ,0xcc ,0xcc ,0xff },//'n'
{0xff ,0xff ,0xe1 ,0xcc ,0xcc ,0xcc ,0xe1 ,0xff },//'o'
{0xff ,0xff ,0xc1 ,0x99 ,0x99 ,0xc1 ,0xf9 ,0xf1 },//'p'
{0xff ,0xff ,0x91 ,0xcc ,0xcc ,0xc1 ,0xcf ,0x87 },//'q'
{0xff ,0xff ,0xc4 ,0x91 ,0x99 ,0xf9 ,0xf0 ,0xff },//'r'
{0xff ,0xff ,0xc1 ,0xfc ,0xe1 ,0xcf ,0xe0 ,0xff },//'s'
{0xf7 ,0xf3 ,0xc1 ,0xf3 ,0xf3 ,0xd3 ,0xe7 ,0xff },//'t'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xcc ,0x91 ,0xff },//'u'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xe1 ,0xf3 ,0xff },//'v'
{0xff ,0xff ,0x9c ,0x94 ,0x80 ,0x80 ,0xc9 ,0xff },//'w'
{0xff ,0xff ,0x9c ,0xc9 ,0xe3 ,0xc9 ,0x9c ,0xff },//'x'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xc0 ,0xcf ,0xe7 },//'y'
{0xff ,0xff ,0xc0 ,0xe6 ,0xf3 ,0xd9 ,0xc0 ,0xff },//'z'
{0xc7 ,0xf3 ,0xf3 ,0xf8 ,0xf3 ,0xf3 ,0xc7 ,0xff },//'{'
{0xe7 ,0xe7 ,0xe7 ,0xff ,0xe7 ,0xe7 ,0xe7 ,0xff },//'|'
{0xf8 ,0xf3 ,0xf3 ,0xc7 ,0xf3 ,0xf3 ,0xf8 ,0xff },//'}'
{0x91 ,0xc4 ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff },//'~'
};


/** display single character on dot matrix **/
void display_char(unsigned char ch,unsigned int delay)
{
        unsigned int j=0,l;     //local variables
//based on delay value same character is displyed on dot matrix
//delay is used for user visibility
        for(l=0;l<delay;l++)
        {
                for(j=0;j<8;j++)        //used for selecting the row by row
                {
                        WRITEBYTE(IOPIN0,ROW,0x00);
                        SIPO_74LS164_1(font[ch-32][j]);
                        WRITEBYTE(IOPIN0,ROW,(1<<j));//selecting j row position
                        delay_us(40);//display time from row to row
                        //delay_ms(5000);
                }
                WRITEBYTE(IOPIN0,ROW,0x00);     //row value 0 for sending data next time
        }
}

void display_str(unsigned char *ch,unsigned int delay)
{
        unsigned int j=0,l;     //local variables
//based on delay value same character is displyed on dot matrix
//delay is used for user visibility
        for(l=0;l<delay;l++)
        {
                for(j=0;j<8;j++)        //used for selecting the row by row
                {
                        WRITEBYTE(IOPIN0,ROW,0x00);
                        SIPO_74LS164_1(font[ch[0]-32][j]);      //display 1st character
                        SIPO_74LS164_2(font[ch[1]-32][j]);      //display 1st character
                        SIPO_74LS164_3(font[ch[2]-32][j]);      //display 1st character
                        SIPO_74LS164_4(font[ch[3]-32][j]);
                        WRITEBYTE(IOPIN0,ROW,(1<<j));//selecting j row position
                        delay_us(40);//display time from row to row
                        //delay_ms(5000);
                }
                WRITEBYTE(IOPIN0,ROW,0x00);     //row value 0 for sending data next time
        }
}


